!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AddressTypeahead=t()}(this,function(){"use strict";function e(e,t){var n=null,i=_(),o=function(o,s){e.apply(o,s),i=_(),n=setTimeout(function(){n=null},t)};return t=t||400,function(){var e=this,s=arguments;!n||_()-i>t?o(e,s):(clearTimeout(n),n=setTimeout(function(){o(e,s)},t))}}function t(){for(var e,n=y.call(arguments),i=y.call(arguments);i;){if(typeof n!=typeof i&&(n=b(i)?[]:w(i)?{}:i),w(i))for(e in i)void 0===i[e]?n[e]=void 0:b(n[e])?[].push.apply(n[e],i[e]):w(n[e])?n[e]=t(n[e],i[e]):n[e]=i[e];i=y.call(arguments)}return n}function n(e,t,n){for(var i=0,o=e.length;i<o;i++)if(t.call(n,e[i],i))return e[i]}function i(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)}function o(e){var t={},n={};return e=e||{},e.on=function(n,i){return t[n]=t[n]||[],t[n].push(i),e},e.once=function(t,i){return n[t]=n[t]||[],n[t].push(i),e},e.off=function(n,o){return t[n]&&i(t[n],o),e},e.emit=function(i,o,s){return t[i]&&t[i].forEach(function(e){e.apply(s,o)}),n[i]&&n[i].splice(0).forEach(function(e){e.apply(s,o)}),e},e}function s(e){this.options=e,this.loading_listeners=[]}function r(e,t){var n={};e.address_components.forEach(function(e){n[e.types[0]]=e.long_name});var i={street:n.route||e.name||"",street_number:Number(n.street_number),postcode:n.postal_code||"",locality:n.locality,sublocality:n.sublocality_level_1,province:n.administrative_area_level_2,region:n.administrative_area_level_1,country:n.country,formatted_address:e.formatted_address,url:e.url,_place:e,_fields:n,_prediction:t};return e.geometry&&e.geometry.location&&(i.location=e.geometry.location),i}function c(e,t){return(e||"").replace(/#([^\s.]+)/,function(e,n){return t.id=n,""}).replace(/\.([^\s.]+)/g,function(e,n){return t.className=t.className?t.className+" "+n:n,""})}function a(e,t,n,i){var o,s=document.createElement(e||"div");if(t)for(o in t)s.setAttribute(o,t[o]);for(o in n)s[o]=n[o];return i&&i.forEach(function(e){s.appendChild(e)}),s}function l(){var e,t,n,i=L.call(arguments);return"string"!=typeof i?(e=i,i=null):e=L.call(arguments),e instanceof Array?(n=e,e=null):t=L.call(arguments),t instanceof Array?(n=t,t={}):t=t||{},i=c(i,t),a(i,e,t,n)}function u(e,t,n){return e.addEventListener("click",t,n)}function d(e,t,n){return e.addEventListener("input",t,n)}function f(e,t,n){return e.addEventListener("focus",t,n)}function p(e,t,n){return e.addEventListener("blur",t,n)}function m(e){return e?", "+e:""}function g(e,t){if(!e)return"";var n=e.sublocality||e.locality||e.city;return e.street+(m(e.street_number)||(t?", ":""))+m(n!==e.street&&n)}function h(e){return e?e.street+m(e.street_number)+m(e.postcode+" "+e.locality)+m(e.province)+m(e.region)+m(e.country):""}function v(e){this.options=e||{},o(this),this.options.google&&(this.provider=new s(this.options.google).load())}var _=Date.now||function(){return(new Date).getTime()},y=[].shift,b=function(e){return e instanceof Array},w=function(e){return"object"==typeof e&&null!==e},E=0;s.prototype.load=function(e){var t=this;if(t.loaded)return e(t);{if(!t.loading){var n=window.document.createElement("script"),i="__googleAPICallback__"+ ++E;return t.loading=!0,window[i]=function(){t.places=window.google.maps.places,t.predictions_OK=window.google.maps.places.PlacesServiceStatus.OK,t.service={autocomplete:new t.places.AutocompleteService,place:new t.places.PlacesService(document.createElement("div"))},delete t.loading,t.loaded=!0,t.loading_listeners.splice(0).forEach(function(e){e(t)})},n.src="https://maps.googleapis.com/maps/api/js?key="+this.options.app_key+"&libraries=places&callback="+i,window.document.head.appendChild(n),this}t.loading_listeners.push(e)}},s.prototype.getPredictions=function(e,n,i){if(e)return this.load(function(o){o.service.autocomplete.getPlacePredictions(t({},o.options,{input:e}),function(e,t){t==o.predictions_OK?n instanceof Function&&n(e):i instanceof Function&&i(t)})});n instanceof Function&&n([])},s.prototype.getPredictionHTML=function(e){for(var t,n,i=0,o=e.description,s="",r=0,c=e.matched_substrings.length;r<c;r++)t=e.matched_substrings[r].offset,n=e.matched_substrings[r].length,s+=o.substr(i,t-i),s+="<strong>"+o.substr(t,n)+"</strong>",i=t+n;return s+=o.substr(i)},s.prototype.getAddress=function(e,t,n){this.service.place.getDetails(e,function(e,i){"OK"===i?t instanceof Function&&t(r(e)):n instanceof Function&&n(i)})},s.prototype.license_img="https://developers.google.com/places/documentation/images/powered-by-google-on-white.png?hl=es-419";var L=Array.prototype.shift,A="classList"in document.documentElement,C=A?function(e,t){return e.classList.contains(t)}:function(e,t){return new RegExp("\\b"+(t||"")+"\\b","").test(e.className)},T=A?function(e,t){e.classList.add(t)}:function(e,t){C(e,t)||(e.className+=" "+t)},N=A?function(e,t){e.classList.remove(t)}:function(e,t){e.className=e.className.replace(new RegExp("\\s*"+t+"\\s*","g")," ")},P=A?function(){var e=document.createElement("span");return e.classList.toggle("test",!0),e.classList.toggle("test",!0),e.classList.contains("test")?function(e,t,n){e.classList.toggle(t,n)}:function(e,t,n){(n=void 0===n?!e.classList.contains(t):n)?e.classList.add(t):e.classList.remove(t)}}():function(e,t){e.className=e.className.replace(new RegExp("\\s*"+t+"\\s*","g")," ")};return v.prototype.bind=function(t,i){function o(){b.emit("change",[t.value,E.address])}function s(){var e=l(".-prediction");return u(e,function(){a(this.getAttribute("data-predition"))}),e}function r(e,t){var n=l(".-prediction._custom"),i=function(){m(),T(n,"_selected"),E.address=e,b.emit("address",[e])};return n.innerHTML=g(e),u(n,i),t&&i(),n}function c(){var e,t,n=S.children;if(w.length>n.length)for(e=0,t=w.length-n.length;e<t;e++)S.appendChild(s());for(e=0,t=w.length;e<t;e++)n[e].innerHTML=A.getPredictionHTML(w[e]),n[e].setAttribute("data-predition",w[e].id),P(n[e],"_custom",w[e].custom);if(w.length<n.length)for(;n[w.length];)S.removeChild(n[w.length])}function a(e){"string"==typeof e&&(e=n(w,function(t){return t.id===e})),e&&(m(),n(S.children,function(t){if(t.getAttribute("data-predition")===e.id)return T(t,"_selected"),!0}),E.prediction=e,A.getAddress(e,function(n){e===E.prediction&&(E.address=n,document.activeElement!==t&&(t.value=g(n,!0)),b.emit("address",[n]),o())}))}function m(){var e,t,n=S.children;for(e=0,t=n.length;e<t;e++)N(n[e],"_selected");for(e=0,t=(n=x.children).length;e<t;e++)N(n[e],"_selected");delete E.prediction,delete E.address}function v(){if(E.address&&E.address.custom&&m(),!t.value)return w=[],c(),m(),void o();A.getPredictions(t.value,function(e){w=e,c(),w[0]&&a(w[0])})}function _(e){setTimeout(function(){t.setSelectionRange(e.street.length+2,e.street.length+2)},10),setTimeout(function(){t.setSelectionRange(e.street.length+2,e.street.length+2)},100)}function y(){C||(E.address&&(t.value=g(E.address,!0)),k.style.display="none",b.emit("blur",[t.value,E.address]))}var b=this,w=[],E={};i=i||{},"string"==typeof t&&(t=document.querySelector(t));var L=i.predictions_parent?"string"==typeof i.predictions_parent?document.querySelector(i.predictions_parent):i.predictions_parent:t.parentElement,A=b.provider,C=!1,S=l(".-predictions-list"),x=l(".-predictions-list._custom-list"),R=l(".-predictions-footer"),k=l(".apz-address-typeahead-predictions",[S,x]);return k.style.display="none",i.custom_address&&function(){var e=l("button.-custom-address",{type:"button"},{textContent:i.custom_address.label});u(e,function(){C=!0,i.custom_address.getter(function(e){C=!1,e.custom=!0,e.formatted_address=h(e),e.url="https://maps.google.com/?q="+encodeURIComponent(e.formatted_address),T(x,"_has_addresses"),x.appendChild(r(e,!0)),w=[],c(),t.value=g(e),y()},function(){C=!1,t.focus()})}),R.appendChild(e)}(),A.license_img&&R.appendChild(l(".-license",[l("img",{src:A.license_img})])),L.appendChild(k),(i.custom_address||A.license_img)&&k.appendChild(R),d(t,e(v)),f(t,function(){k.style.display="",E.address&&!E.address.street_number&&_(E.address)}),p(t,function(){setTimeout(y,100)}),t.value&&v(),b},v});