!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AddressTypeahead=t()}(this,function(){"use strict";var r=[].shift;function a(e){return e instanceof Array}function l(e){return"object"==typeof e&&null!==e}function k(t,n){return function(e){e.apply(n,t)}}function E(i){var s={},c={};return(i=i||{}).on=function(e,t){return s[e]=s[e]||[],s[e].push(t),i},i.once=function(e,t){return c[e]=c[e]||[],c[e].push(t),i},i.off=function(e,t){return s[e]&&function(e,t){for(var n=e.length-1;0<=n;n--)e[n]===t&&e.splice(n,1)}(s[e],t),i},i.emit=function(e,t,n){var o=k(t,n);return s[e]&&s[e].forEach(o),c[e]&&c[e].splice(0).forEach(o),i},i}var s=Array.prototype.shift;function u(){var e,t,n,o,i=s.call(arguments);return"string"!=typeof i?(e=i,i=null):e=s.call(arguments),e instanceof Array?(n=e,e=null):t=s.call(arguments),t instanceof Array?(n=t,t={}):t=t||{},o=t,function(e,t,n,o){var i,s=document.createElement(e||"div");if(t)for(i in t)s.setAttribute(i,t[i]);for(i in n)s[i]=n[i];return o&&o.forEach(function(e){s.appendChild(e)}),s}(i=(i||"").replace(/#([^\s.]+)/,function(e,t){return o.id=t,""}).replace(/\.([^\s.]+)/g,function(e,t){return o.className=o.className?o.className+" "+t:t,""}),e,t,n)}var e,d="classList"in document.documentElement?((e=document.createElement("span")).classList.toggle("test",!0),e.classList.toggle("test",!0),e.classList.contains("test")?function(e,t,n){e.classList.toggle(t,n)}:function(e,t,n){(n=void 0===n?!e.classList.contains(t):n)?e.classList.add(t):e.classList.remove(t)}):function(e,t){e.className=e.className.replace(new RegExp("\\s*"+t+"\\s*","g")," ")};function P(e,t,n,o){return e.addEventListener(t,n,o)}function t(e){this.options=e||{},this.loading_listeners=[],this.addresses_cache={},this.predictions_cache={}}var i=0;t.prototype.load=function(e){var t=this;if(t.loaded)return e(t);if(!t.loading){var n=window.document.createElement("script"),o="__googleAPICallback__"+ ++i;return t.loading=!0,window[o]=function(){t.places=window.google.maps.places,t.predictions_OK=window.google.maps.places.PlacesServiceStatus.OK,t.session_token=new t.places.AutocompleteSessionToken,t.service={autocomplete:new t.places.AutocompleteService,place:new t.places.PlacesService(document.createElement("div"))},delete t.loading,t.loaded=!0,t.loading_listeners.splice(0).forEach(function(e){e(t)})},n.src="https://maps.googleapis.com/maps/api/js?key="+this.options.app_key+"&libraries=places&callback="+o,window.document.head.appendChild(n),this}t.loading_listeners.push(e)},t.prototype.getPredictions=function(n,o,i){if("string"==typeof n&&(n=n.trim()),n){var s=this,c=s.predictions_cache;return c[n]?o(c[n]):s.load(function(){s.service.autocomplete.getPlacePredictions(function e(){for(var t,n=r.call(arguments),o=r.call(arguments);o;){if(typeof n!=typeof o&&(n=a(o)?[]:l(o)?{}:o),l(o))for(t in o)void 0===o[t]?n[t]=void 0:a(n[t])?[].push.apply(n[t],o[t]):l(n[t])?n[t]=e(n[t],o[t]):n[t]=o[t];o=r.call(arguments)}return n}({},s.options,{input:n,sessionToken:s.options.session_token||s.session_token}),function(e,t){t==s.predictions_OK?(c[n]=e,o instanceof Function&&o(e)):i instanceof Function&&i(t)})}),s}o instanceof Function&&o([])},t.prototype.getPredictionHTML=function(e){var t,n,o=0,i=e.description,s="";if(!e.matched_substrings)return e.formatted_address;for(var c=0,r=e.matched_substrings.length;c<r;c++)t=e.matched_substrings[c].offset,n=e.matched_substrings[c].length,s+=i.substr(o,t-o).replace(/^ | $/g,"&nbsp;"),s+="<strong>"+i.substr(t,n).replace(/^ | $/g,"&nbsp;")+"</strong>",o=t+n;return s+=i.substr(o)};var c="address_component, adr_address, alt_id, formatted_address, geometry, icon, id, name, permanently_closed, photo, place_id, plus_code, scope, type, url, utc_offset, vicinity".split(/ *, */);function p(e){return e?("string"==typeof e&&(e=e.trim()),", "+e):""}function C(e,t,n){if(!e)return"";var o=e.sublocality||e.locality||e.city;return e.street+(p(e.street_number)||(t?", ":""))+p(!1!==n&&o!==e.street&&o)}function A(e,t,n,o){return e?e.street+p(e.street_number||(t?" ":""))+p(e.postcode+" "+e.locality)+p(e.province!==e.locality&&e.province)+p(n&&e.region)+p(o&&e.country):""}function T(e,t){setTimeout(function(){e.setSelectionRange(t.street.length+2,t.street.length+2)},10),setTimeout(function(){e.setSelectionRange(t.street.length+2,t.street.length+2)},100)}t.prototype.getAddress=function(n,o,i){var s=this.addresses_cache;if(!n||!n.place_id)throw new TypeError("prediction is not a valid prediction");if(s[n.place_id])return o(s[n.place_id]);this.service.place.getDetails({placeId:n.place_id,fields:this.options.place_fields||c},function(e,t){"OK"===t?(s[n.place_id]=function(e,t){var n={};e.address_components.forEach(function(e){n[e.types[0]]=e.long_name});var o={street:n.route||e.name||"",street_number:Number(n.street_number),postcode:n.postal_code||"",locality:n.locality,sublocality:n.sublocality_level_1,province:n.administrative_area_level_2,region:n.administrative_area_level_1,country:n.country,formatted_address:e.formatted_address,url:e.url,place:e,_fields:n,_prediction:t};return e.geometry&&e.geometry.location&&(o.location={type:"Point",coordinates:[e.geometry.location.lng instanceof Function?e.geometry.location.lng():e.geometry.location.lng,e.geometry.location.lat instanceof Function?e.geometry.location.lat():e.geometry.location.lat]}),o}(e,n),o instanceof Function&&o(s[n.place_id])):i instanceof Function&&i(t)})},t.prototype.license_img="https://developers.google.com/places/documentation/images/powered-by-google-on-white.png?hl=es-419";var f=Array.prototype.push;function L(n,e){var t,o=this,i=u(".-predictions-list"),s=u(".-predictions-footer"),c=u(e.wrapper_selector||".apz-typeahead_predictions",[i]);E(o),o.TA=n,o.options=e,o.wrapper_el=c,o.list_el=i,o.custom_predictions=[],o._onDocumentClick=function(e){var t=e.target;if(!o.showing_custom&&n.focus_root.activeElement!==n.input_el){for(;t&&t!==document.body;){if(t===c||t===n.input_el)return;t=t.parentElement}o.hide()}},o.hide(),(e.predictions_parent?"string"==typeof e.predictions_parent?n.focus_root.querySelector(e.predictions_parent):e.predictions_parent:n.input_el.parentElement).appendChild(c),e.custom_address&&(P(t=u("button.-custom-address",{type:"button"},{textContent:e.custom_address.label}),"click",function(){o.showing_custom=!0,e.custom_address.getter(function(e){o.showing_custom=!1,e.place="custom",e.formatted_address=A(e),e.url="https://maps.google.com/?q="+encodeURIComponent(e.formatted_address),o.setPredictions([],e),o.render(),o.select(e),o.emit("custom_address",[e]),o.hide()},function(){o.showing_custom=!1,o.emit("cancel-custom_address")})}),s.appendChild(t));var r=e.custom_provider_image||n.provider.license_img;r&&s.appendChild(u(".-license",[u("img",{src:r})])),(e.custom_address||r)&&c.appendChild(s)}function n(e,t){var n=e.indexOf(this.selected);0<=n&&e[n+t]&&this.select(e[n+t])}L.prototype.show=function(e){this.wrapper_el.style.display="",(this.is_hidden=!1)!==e&&this.render(),P(document,"click",this._onDocumentClick,!0)},L.prototype.hide=function(){var e,t,n,o;this.wrapper_el.style.display="none",this.is_hidden=!0,e=document,t="click",n=this._onDocumentClick,o=!0,e.removeEventListener(t,n,o)},L.prototype.hasFocus=function(){var e=this.TA.focus_root.activeElement;return e===this.wrapper_el||this.wrapper_el.contains(e)},L.prototype.select=function(e){var t=this.list_el.children||[];this.selected=e;for(var n=0,o=t.length;n<o;n++)d(t[n],"_is-selected",t[n].prediction===e);this.emit("selected",[e])},L.prototype.selectPrevious=function(){this.loaded_predictions&&n.call(this,this.loaded_predictions,-1)},L.prototype.selectNext=function(){this.loaded_predictions&&n.call(this,this.loaded_predictions,1)},L.prototype.setPredictions=function(e,t){var n=this;e&&(e=e.slice());var o=(e=e||n.predictions_data||[]).slice();n.options.keep_custom?n.custom_predictions.length&&(t&&n.custom_predictions.push(t),f.apply(o,n.custom_predictions)):t&&o.push(t),n.predictions_data=e,n.loaded_predictions=o,n.select(n.selected&&0<=o.indexOf(n.selected)?n.selected:o[0]||null)},L.prototype.clear=function(e){e&&this.custom_predictions.splice(0),this.render([])},L.prototype.addCustomPrediction=function(e){this.custom_predictions.push(e),this.setPredictions()},L.prototype.render=function(e){var t=this;e&&t.setPredictions(e);var n,o,i,s=t.loaded_predictions||[],c=this.list_el,r=this.wrapper_el,a=c.children;function l(){t.select(this.prediction)}if(d(r,"_has-predictions",t.predictions_data&&t.predictions_data.length),d(r,"_has-custom_predictions",t.custom_predictions.length),s.length>a.length)for(n=0,o=s.length-a.length;n<o;n++)i=u(".-prediction",{tabindex:"0"}),c.appendChild(i),P(i,"click",l);for(n=0,o=s.length;n<o;n++)a[n].innerHTML=t.TA.provider.getPredictionHTML(s[n])||C(s[n]),a[n].prediction=s[n],d(a[n],"_is-custom","custom"===s[n].place),d(a[n],"_is-selected",s[n]===t.selected);if(s.length<a.length)for(;a[s.length];)c.removeChild(a[s.length])};function o(e){e=e||{},this.options=e,this.focus_root=e.focus_root||document,e.google&&(this.provider=new t(e.google).load())}return o.prototype.bind=function(i,s){var t=null,c=!1,r=null,a=null,l=null,n=E({get value(){return i.value},set value(e){i.value=e,v()},get address(){return t},set address(e){e&&e.place&&("custom"===(t=e).place?(p.addCustomPrediction(e),i.value=C(e),p.select(e)):(p.setPredictions([e.place]),i.value=C(e,!0),p.select(e.place)),f("change"))}});s=s||{};var u=this.focus_root,d=this.provider;"string"==typeof i&&(i=u.querySelector(i)),this.input_el=i;var p=new L(this,s);function o(e){i.value=e}function f(e){n.emit(e,[i.value,t,c])}function h(e){l=null,t=e,f("change")}var e,m,_=null;function g(){a&&(a.timeout&&clearTimeout(a.timeout),a=null)}function v(){if(i.value!==_){var e,t,n=a;if(g(),_=i.value,e=i.value,t=e&&e.match(/.*?, *(\d+) *(,.*?)?$|^.*? \d+/),c=t?t[1]:null,!i.value)return r="",p.clear(),void h(null);var o=i.value;a={listeners:[],input_value:i.value,timeout:setTimeout(function(){d.getPredictions(i.value,function(e){if(p.render(e),e.length&&i.value===o&&a){var t=a.listeners;g(),t.forEach(k(e))}},function(){i.value===o&&g()})},n?s.debounce_duration||400:0)}}else u.activeElement===i&&p.show()}function y(){p.show(),t&&!t.street_number?(o(A(t,!0)),T(i,t)):t&&o(C(t,!0,!1))}function w(){a?a.listeners.push(w):l?l.push(w):(t&&!t.street_number?(o(C(t,!0,!0)),T(i,t),v()):(b(),p.hide()),s.onEnter instanceof Function&&s.onEnter(t))}function b(){a?a.listeners.push(b):l?l.push(b):o(A(t,!0))}return p.on("selected",function(e){if(!e)return h(null);var n,o;r=i.value,"custom"===e.place?h(e):(n=e,l=[],d.getAddress(n,function(e){if(i.value===r&&p.selected===n){var t=l;h(e),o instanceof Function&&o(e),t&&t.forEach(k([e]))}}))}),P(i,"input",v),P(i,"change",v),P(i,"focus",y),P(i,"click",y),p.on("cancel-custom_address",function(){i.focus()}),P(i,"click",function(){p.show()}),i.addEventListener("keydown",function(e){switch(13!==e.keyCode&&p.show(),e.keyCode){case 27:o(""),v();break;case 13:if(p.is_hidden)return;e.preventDefault(),w();break;case 38:e.preventDefault(),p.selectPrevious();break;case 40:e.preventDefault(),p.selectNext()}}),P(i,"blur",(e=100,m=function(){b(),p.showing_custom||u.activeElement===i||p.hide()},function(){setTimeout(m,e)})),n.input=i,n.focus=function(){return i.focus(),n},i.value?v():s.try_searches&&function t(n,o,i){var s=n.shift();s&&o(s,function(e){e&&e[0]?i(e,s):t(n,o,i)})}(s.try_searches,d.getPredictions.bind(d),function(e,t){p.setPredictions(e),p.select(e[0]),o(t)}),n},o});